{% extends "mobile/layout.html" %}
{% set show_back_arrow = True %}

{% block content %}
<div class="max-w-lg mx-auto">
    <!-- Disabled overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-50 z-40 flex items-center justify-center pointer-events-none">
        <div class="bg-white rounded-lg p-6 shadow-lg text-center">
            <i class="fas fa-tools text-gray-400 text-4xl mb-4"></i>
            <h3 class="text-xl font-bold text-gray-700 mb-2">Feature Temporarily Disabled</h3>
            <p class="text-gray-600">This feature is currently under maintenance.</p>
        </div>
    </div>

    <!-- Main content (grayed out) -->
    <div class="opacity-30 pointer-events-none">
        <!-- Consistent Page Header (matches Update Availability/Find Sub) -->
        <div class="flex items-center gap-3 mt-4 mb-1 px-4">
          <div class="bg-white rounded-md flex items-center justify-center h-12 w-12">
            <i class="fas fa-clipboard-list text-black text-3xl"></i>
          </div>
          <div>
            <div class="text-2xl font-bold leading-tight">Create Lineup</div>
            <div class="text-base text-gray-500 mt-1">Generate optimal lineups based on player availability and performance data.</div>
          </div>
        </div>

        <!-- Card 1: Select Available Players -->
        <div class="card bg-base-100 shadow-xl mb-2">
          <div class="card-body">
            <h2 class="card-title">Select Available Players</h2>
            <div id="players-list" class="flex flex-col gap-2 mt-2">
              <!-- Player checkboxes will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Card 2: Lineup Instructions -->
        <div class="card bg-base-100 shadow-xl mb-2">
          <div class="card-body">
            <h2 class="card-title">Lineup Instructions</h2>
            <ul id="instructions-list" class="mb-4 flex flex-col gap-2">
              <!-- Instructions will be loaded here -->
            </ul>
            <div class="flex gap-2">
              <input id="new-instruction" type="text" class="input input-bordered flex-1" placeholder="Add new instruction..." disabled />
              <button id="add-instruction-btn" class="btn btn-primary" disabled>Add</button>
            </div>
          </div>
        </div>

        <!-- Card 3: Generated Lineup -->
        <div class="card bg-base-100 shadow-xl mb-2" id="generated-lineup-card" style="display:none;">
          <div class="card-body">
            <h2 class="card-title">Generated Lineup</h2>
            <pre id="generated-lineup" class="bg-base-200 p-3 rounded-lg whitespace-pre-wrap text-sm"></pre>
          </div>
        </div>

        <!-- Generate Button & Loading -->
        <div class="flex flex-col items-center">
          <button id="generate-lineup-btn" class="btn btn-primary w-full mb-2" disabled>Generate Lineup</button>
          <div id="loading-indicator" class="hidden flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-2"></div>
            <span>Generating lineup...</span>
          </div>
        </div>

<script>
const user = window.sessionData?.user || {};
const series = user.series;
const club = user.club;
const teamId = club && series ? `${club} - ${series.split(' ').pop()}` : '';

let players = [];
let selectedPlayers = new Set();
let instructions = [];

// --- 1. Load Players ---
function loadPlayers() {
  fetch(`/api/players?series=${encodeURIComponent(series)}`)
    .then(res => {
      if (!res.ok) {
        throw new Error(`Server error: ${res.status} ${res.statusText}`);
      }
      return res.json();
    })
    .then(data => {
      if (data.error) {
        throw new Error(data.error);
      }
      players = data;
      // Select all players by default on load
      selectedPlayers = new Set(players.map(p => p.name));
      renderPlayers();
    })
    .catch(error => {
      console.error('Error loading players:', error);
      document.getElementById('players-list').innerHTML = `<span class="text-error">Failed to load players: ${error.message}</span>`;
    });
}

function renderPlayers() {
  const list = document.getElementById('players-list');
  list.innerHTML = '';
  players.forEach(player => {
    const id = `player-${player.name.replace(/\s+/g, '-')}`;
    const checked = selectedPlayers.has(player.name);
    const div = document.createElement('div');
    div.className = 'flex items-center';
    div.innerHTML = `
      <input type="checkbox" id="${id}" class="checkbox mr-2" ${checked ? 'checked' : ''} disabled />
      <label for="${id}" class="flex-1">${player.name}</label>
    `;
    const checkbox = div.querySelector('input');
    checkbox.checked = checked;
    // Disabled - no event listeners added
    list.appendChild(div);
  });
}

// --- 2. Load & Manage Instructions ---
function loadInstructions() {
  fetch(`/api/lineup-instructions?team_id=${encodeURIComponent(teamId)}`)
    .then(res => {
      if (!res.ok) {
        throw new Error(`Server error: ${res.status} ${res.statusText}`);
      }
      return res.json();
    })
    .then(data => {
      if (data.error) {
        throw new Error(data.error);
      }
      instructions = data.instructions || [];
      renderInstructions();
    })
    .catch(error => {
      console.error('Error loading instructions:', error);
      document.getElementById('instructions-list').innerHTML = `<li class="text-error">Failed to load instructions: ${error.message}</li>`;
    });
}

function renderInstructions() {
  const list = document.getElementById('instructions-list');
  list.innerHTML = '';
  instructions.forEach(instr => {
    const li = document.createElement('li');
    li.className = 'flex items-center justify-between bg-base-200 rounded px-2 py-1';
    li.innerHTML = `
      <span class="flex-1">${instr}</span>
      <button class="btn btn-xs btn-error ml-2" disabled>üóëÔ∏è</button>
    `;
    // Disabled - no event listeners added
    list.appendChild(li);
  });
}

// Disabled - no event handler for add instruction button
// document.getElementById('add-instruction-btn').onclick = () => { ... };

function deleteInstruction(instr) {
  fetch(`/api/lineup-instructions`, {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ instruction: instr, team_id: teamId })
  })
    .then(res => {
      if (!res.ok) {
        throw new Error(`Server error: ${res.status} ${res.statusText}`);
      }
      return res.json();
    })
    .then(data => {
      if (data.error) {
        throw new Error(data.error);
      }
      loadInstructions();
    })
    .catch(error => {
      console.error('Error deleting instruction:', error);
      alert(`Failed to delete instruction: ${error.message}`);
    });
}

// --- 3. Generate Lineup ---
// Disabled - no event handler for generate lineup button
// document.getElementById('generate-lineup-btn').onclick = () => { ... };

// --- Initial Load ---
document.addEventListener('DOMContentLoaded', () => {
  // Load data for display but keep everything disabled
  loadPlayers();
  loadInstructions();
});
</script>
    </div>
</div>
{% endblock %} 